name: 'Extension workflow'
on:
  push:
jobs:
  run:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [ubuntu-latest, macos-latest]
        php-versions: ['5.3', '5.4', '5.5', '5.6', '7.0', '7.1', '7.2', '7.3', '7.4']
    name: PHP ${{ matrix.php-versions }} Test on ${{ matrix.operating-system }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: ${{ matrix.php-versions }}
      - name: Setup ioncube
        run: |
          install_ioncube() {
            if [ ! -e "$ext_dir/ioncube.so" ]; then
              os_name='lin'
              [ "$(uname -s)" = "Darwin" ] && os_name='mac'
              curl -SL https://downloads.ioncube.com/loader_downloads/ioncube_loaders_"$os_name"_x86-64.tar.gz | tar -xzf - -C /tmp
              sudo mv /tmp/ioncube/ioncube_loader_"$os_name"_"$version".so "$ext_dir/ioncube.so"
            fi
            echo "zend_extension=$ext_dir/ioncube.so" | sudo tee "$scan_dir/00-ioncube.ini"
          }

          version=$
          scan_dir=$(php --ini | grep additional | sed -e "s|.*: s*||")
          ext_dir=$(php -i | grep "extension_dir => /" | sed -e "s|.*=> s*||")
          install_ioncube
      - name: Testing PHP version
        run: php -v
      - name: Testing Extensions
        run: |
          php -m

  
name: Runner workflow
on:
  push:
jobs:
  ubuntu:
    name: runner
    runs-on: ubuntu-latest
    steps:
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 7.4
          tools: pecl
          extensions: protobuf
      - name: Test
        run: |
          php -v && php -m
          git clone https://github.com/grpc/grpc
          cd grpc
          bazel --batch_cpu_scheduling --io_nice_level 7 build --jobs 6 --local_ram_resources=HOST_RAM*0.5 @com_google_protobuf//:protoc
          bazel --batch_cpu_scheduling --io_nice_level 7 build --jobs 6 --local_ram_resources=HOST_RAM*0.5 src/compiler:grpc_php_plugin
          sudo cp ./bazel-bin/external/com_google_protobuf/protoc /usr/bin/protoc
          sudo cp ./bazel-bin/src/compiler/grpc_php_plugin /usr/bin/grpc_php_plugin
          chmod a+x /usr/bin/protoc /usr/bin/grpc_php_plugin
          cd examples/php
          protoc --proto_path=../protos --php_out=. --grpc_out=. --plugin=protoc-gen-grpc=/usr/bin/grpc_php_plugin ../protos/helloworld.proto
          ls .
          ls ../protos
          composer install

name: Multiarch workflow
on:
  push:
jobs:
  run:
    runs-on: ubuntu-latest
    container: shivammathur/node:latest-${{ matrix.arch }}
    strategy:
      matrix:
        arch: ["amd64", "i386"]
    steps:
      - run: |
          rm -rf $(which node12)
          ln -sf $(which node) /usr/bin/node12
      - uses: actions/checkout@v2
      - name: Install PHP
        run: |
          # Update spc (See https://github.com/shivammathur/spc for options)
          spc -U

          # Install PHP
          spc --php-version "7.4" \
              --extensions "mbstring, intl" \
              --ini-values "post_max_size=256M, short_open_tag=On" \
              --coverage "xdebug" \
              --tools "php-cs-fixer, phpunit"
      - name: check int size
        # PHP_INT_SIZE is 4 for 32 bit and 8 for 64 bit
        run: php -r "echo PHP_INT_SIZE;"

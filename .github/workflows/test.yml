name: 'Intl workflow'
on:
  push:
jobs:
  focal:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      max-parallel: 15
      matrix:
        os: [ubuntu-20.04, ubuntu-18.04, ubuntu-16.04]
        icu: [69.1]
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 5.6
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 7.0
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 7.1
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 7.2
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 7.3
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 7.4
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 8.0
          extensions: intl-${{ matrix.icu }}
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: 8.1
          extensions: intl-${{ matrix.icu }}
      - uses: mxschmitt/action-tmate@v3.5    
      - name: Testing ICU version
        run: |
          for v in 5.6 7.0 7.1 7.2 7.3 7.4 8.0 8.1; do
            icu_version=$(php$v -i | grep "ICU version =>" | sed -e "s|.*=> s*||")
            echo php$v: $icu_version
            [ "$icu_version" != "${{ matrix.icu }}" ] && 	echo "::warning::failed to setup ${{ matrix.icu }} on php $v"
            php$v -v
          done

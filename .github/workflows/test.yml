name: 'Windows workflow'
on:
  push:
jobs:
  run:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [windows-latest]
        php-versions: ['7.4']
    name: PHP ${{ matrix.php-versions }} Test on ${{ matrix.operating-system }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Update pwsh
        run: Invoke-Expression "& { $(Invoke-RestMethod 'https://aka.ms/install-powershell.ps1') } -daily"
      - name: Install PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: ${{ matrix.php-versions }}
      - name: Debug
        run: |
          if(Test-Path $profile) {
            echo "profile"
            type $profile
          }
          if(Test-Path $PsHome\Profile.ps1) {
            echo "$PsHome\Profile.ps1"
            type $PsHome\Profile.ps1
          }
          if(Test-Path $PsHome\Microsoft.PowerShell_profile.ps1) {
            echo "$PsHome\Microsoft.PowerShell_profile.ps1"
            type $PsHome\Microsoft.PowerShell_profile.ps1
          }                           
          Get-Module -All
          [environment]::GetEnvironmentVariable("POWERSHELL_UPDATECHECK")
          [environment]::GetEnvironmentVariable("POWERSHELL_UPDATECHECK_OPTOUT")
          [environment]::GetEnvironmentVariable("POWERSHELL_TELEMETRY_OPTOUT")      
      - name: Test PHP
        run: php -v
      - name: Test php extensions
        run: php -m

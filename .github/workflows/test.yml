name: 'Test'
on: [push]
env:
  HOMEBREW_NO_INSTALL_CLEANUP: 1
  HOMEBREW_NO_AUTO_UPDATE: 1
jobs:
  tests:  
    strategy:
      matrix:
        os: [macos-10.15]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Install apache2
        run: |
          brew install httpd
          sudo sed -Ei '' 's/Listen .*/Listen 80/' $(brew --prefix)/etc/httpd/httpd.conf
      - name: Install nginx
        run: |
          brew install nginx
          sudo sed -Ei '' 's/listen.*/listen 80;/' $(brew --prefix)/etc/nginx/nginx.conf
      - name: Test setup
        run: |
          brew services list
          for service in httpd nginx; do
            brew services start "$service"
            brew services list | grep "$service"          
            brew services stop "$service"
          done

name: Multiarch workflow
on:
  push:
jobs:
  run:
    runs-on: ubuntu-latest
    container: 
      image: shivammathur/node:latest-${{ matrix.arch }}
      volumes: 
        - '/lib/x86_64-linux-gnu/libdl.so.2:/lib/libdl.so.2'
        - '/lib/x86_64-linux-gnu/libgcc_s.so.1:/lib/libgcc_s.so.1'
        - '/usr/lib/x86_64-linux-gnu/libstdc++.so.6:/lib/libstdc++.so.6'
    strategy:
      matrix:
        arch: ["amd64", "i386"]
    steps:
      - uses: actions/checkout@v2
      - name: Install PHP
        run: |
          # Update spc (See https://github.com/shivammathur/spc for options)
          spc -U

          # Install PHP
          spc --php-version "7.4" \
              --extensions "mbstring, intl" \
              --ini-values "post_max_size=256M, short_open_tag=On" \
              --coverage "xdebug" \
              --tools "php-cs-fixer, phpunit"
      - name: check int size
        # PHP_INT_SIZE is 4 for 32 bit and 8 for 64 bit
        run: php -r "echo PHP_INT_SIZE;"

name: Test workflow
on: [push]
jobs:
  run:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      matrix:
        operating-system: [windows-latest]
        php-versions: ['7.4']
    name: Test ${{ matrix.operating-system }} - ${{ matrix.php-versions }}
    steps:
    - name: Test windows
      run: |
        Function Get-PathFromRegistry {
          $env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" +
                  [System.Environment]::GetEnvironmentVariable("Path","User")
        }

        Function Add-Path {
          param(
            [string]$PathItem
          )
          $currentPath = (Get-ItemProperty -Path 'hkcu:\Environment' -Name PATH).Path
          if ($currentPath -contains $PathItem) {
            $currentPath = $currentPath -replace "$PathItem;"
          }
          $newPath = $PathItem + ';' + $currentPath
          Set-ItemProperty -Path 'hkcu:\Environment' -Name Path -Value $NewPath
          Get-PathFromRegistry
        }
        Add-Path C:\tools        
        Write-Output $env:PATH
        try {        
          if(-not(Test-Path -LiteralPath $profile)) {            
            New-Item [System.IO.Path]::GetDirectoryName($profile) -ItemType Directory >$null 2>&1
            New-Item $profile -ItemType File >$null 2>&1
          }        
          if($null -eq (Get-Content $profile | findstr 'Get-PathFromRegistry')) { 
            Add-Content -Path $profile -Value 'Function Get-PathFromRegistry { $env:Path = [System.Environment]::GetEnvironmentVariable("Path", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path", "User") }; Get-PathFromRegistry' 
          }
        } catch [Exception] {
          echo $_.Exception|format-list -force
        }
    - name: Test windows
      run: |
        Write-Output $env:PATH

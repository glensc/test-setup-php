name: Tools workflow
on:
  push:
jobs:  
  versions:
    name: tools
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [macos-latest]
        php-versions: ['7.4']
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: ${{ matrix.php-versions }}
      - name: Testing Tools
        run: |
          curl_opts=(-sSL --retry 5 --retry-delay 1)
          grpc_tag=$(curl "${curl_opts[@]:?}" https://grpc.io/release)
          curl "${curl_opts[@]:?}" "https://github.com/grpc/grpc/archive/$grpc_tag.tar.gz" | tar -xz -C /tmp
          cd "/tmp/grpc-${grpc_tag:1}" || exit
          export DISABLE_BAZEL_WRAPPER=1
          bazel build src/compiler:grpc_php_plugin
          

name: Multiarch workflow
on:
  push:
jobs:
  ubuntu:
    name: multiarch    
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        tag: ["amd64", "i386", "arm32v7", "arm64v8"]
        php: ['7.3', '7.4']
    steps:
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v1
      - run: |
          echo '{"experimental": true}' | sudo tee /etc/docker/daemon.json > /dev/null
          sudo systemctl restart docker
          docker run --rm --tty --privileged \
            --volume "$GITHUB_WORKSPACE":"$GITHUB_WORKSPACE" \
            --workdir "$GITHUB_WORKSPACE" \
            shivammathur/node:bionic-${{ matrix.tag }} php -r "echo PHP_INT_SIZE;"
      - name: Setup PHP
        # Inputs to manual.sh are in this order - php-versions, extensions, ini-values, coverage, tools
        run: curl -sL https://setup-php.com/manual.sh | bash -s ${{ matrix.php }} "intl" "memory_limit=-1" "pcov" "phpunit"
      - run: php -v && php -m  
      - name: check int size
        # PHP_INT_SIZE is 4 for 32 bit and 8 for 64 bit
        run: php -r "echo PHP_INT_SIZE;"

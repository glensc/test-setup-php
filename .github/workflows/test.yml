name: 'Extension develop workflow'
on:
  push:
jobs:
  disable:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [ubuntu-latest, macos-latest]
    steps:
    - name: Get liblz4 directory
      id: lz4
      run: |
        if [ "$(uname -s)" = "Linux" ]; then
          echo "::set-output name=lz4-dir::/usr"
        else
          echo "::set-output name=lz4-dir::$(brew --prefix)/opt/lz4"
        fi
    - name: Setup PHP
      uses: shivammathur/setup-php@develop
      with:
        php-version: '8.0'  
        extensions: pecl_http-4.2.0, redis-5.3.6
      env:
        HTTP_CONFIGURE_PREFIX_OPTS: CFLAGS=-Wno-implicit-function-declaration
        HTTP_CONFIGURE_OPTS: --with-http
        REDIS_CONFIGURE_OPTS: --enable-redis  --enable-redis-lz4 --with-liblz4=${{ steps.lz4.outputs.lz4-dir }}
        REDIS_LINUX_LIBS: liblz4-dev
        REDIS_DARWIN_LIBS: lz4
    - name: Testing PHP version
      run: php -v
    - name: Testing Extensions
      run: |
        php -r "echo phpversion('http');"
        echo ""
        php -r "echo phpversion('redis');"
        php -m          

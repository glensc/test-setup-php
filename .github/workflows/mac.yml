name: Test workflow
on: [push]
jobs:
  run:    
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:      
        operating-system: [macos-latest]
        php-versions: ['52', '53', '54', '55']      
    name: PHP ${{ matrix.php-versions }} Test on ${{ matrix.operating-system }}
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Install PHP
      run: |
        curl -o port.pkg -sSL https://github.com/macports/macports-base/releases/download/v2.6.2/MacPorts-2.6.2-10.15-Catalina.pkg
        sudo installer -pkg port.pkg -target /
        export PATH="/opt/local/bin:/opt/local/sbin:$PATH"
        sudo port sync
        sudo port search --name --line --regex '^php\d*$'
        sudo port install php$v
        if [ "$v" != "52" ]; then
          sudo cp /opt/local/etc/php$v/php.ini-development /opt/local/etc/php$v/php.ini
          sudo port install php$v-cgi php$v-gd php$v-curl php$v-iconv php$v-gettext php$v-mbstring php$v-imap php$v-mcrypt php$v-xmlrpc php$v-mysql php$v-openssl php$v-sockets php$v-zip php$v-tidy php$v-xsl php$v-opcache php$v-sqlite
        else
          sudo cp /opt/local/etc/php$v/php.ini-recommended /opt/local/etc/php$v/php.ini
          sudo port install php$v-cgi php$v-gd php$v-curl php$v-iconv php$v-gettext php$v-mbstring php$v-imap php$v-mcrypt php$v-xmlrpc php$v-mysql php$v-openssl php$v-sockets php$v-zip php$v-tidy php$v-xsl
        fi      
        sudo mkdir -p /usr/local/bin
        sudo ln -sf /opt/local/bin/* /usr/local/bin
      env:
        v: ${{ matrix.php-versions }}
    - name: Testing PHP version
      run: php -v
    - name: Testing PHP extensions
      run: php -m

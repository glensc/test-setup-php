name: Test workflow
on: [push]
jobs:
  run:    
    runs-on: ${{ matrix.operating-system }}
    container: ubuntu:focal
    strategy:
      fail-fast: false
      matrix:      
        operating-system: [ubuntu-latest]
    name: Test
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: Add requirements
      run: apt-get update && apt-get install curl -y
      
    - name: Add zstd
      shell: bash
      run: |
        get() {
          file_path=$1
          shift
          links=("$@")
          for link in "${links[@]}"; do
            status_code=$(curl -w "%{http_code}" -o "$file_path" -sL "$link")
            [ "$status_code" = "200" ] && break
          done
        }        
        zstd_version=$(curl -sL https://api.bintray.com/packages/homebrew/bottles/zstd | sed -e 's/^.*"latest_version":"\([^"]*\)".*$/\1/')
        tar_file="zstd-$zstd_version.x86_64_linux.bottle.tar.gz"
        # linuxbrew bottles might be merged in homebrew
        get /tmp/"$tar_file" "http://dl.bintray.com/linuxbrew/bottles/$tar_file" "http://dl.bintray.com/homebrew/bottles/$tar_file"
        tar -xzf /tmp/"$tar_file" -C /
    - name: Test zstd
      run: zstd -V
      

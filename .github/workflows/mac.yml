name: Test workflow #test1
on: [push]
jobs:
  run:    
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:      
        operating-system: [macos-10.15]
        php: ['7.4', '8.0']
    name: Test macOS
    steps:
    - name: Checkout
      uses: actions/checkout@v2 
 
    - name: Patch
      run: |
        brew tap shivammathur/php
        brew_prefix="$(brew --prefix)"
        tap_dir="$brew_prefix"/Homebrew/Library/Taps
        mv $tap_dir/shivammathur/homebrew-php/Formula/php.rb $tap_dir/shivammathur/homebrew-php/Formula/php@7.4.rb
        mv $tap_dir/shivammathur/homebrew-php/Formula/php@8.0.rb $tap_dir/shivammathur/homebrew-php/Formula/php.rb
        sudo sed -i '' "s/class PhpAT80/class Php/" $tap_dir/shivammathur/homebrew-php/Formula/php.rb
        sudo sed -i '' "s/class Php/Class PhpAT74/" $tap_dir/shivammathur/homebrew-php/Formula/php@7.4.rb
        (
          cd $tap_dir/shivammathur/homebrew-php/Aliases
          sudo ln -sf ../Formula/php.rb php@8.0
          sudo rm -rf ./php@7.4
        )
        ls $tap_dir/shivammathur/homebrew-php/Formula
        ls $tap_dir/shivammathur/homebrew-php/Aliases
    
    - name: Setup PHP
      uses: shivammathur/setup-php@develop
      with:
        php-version: ${{ matrix.php }}

    - name: Test PHP version
      run: |
        php -v
      
    - name: Test PHP extensions
      run: php -m

name: 'Test 8.0'
on:
  push:
jobs:
  run:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      matrix:
        operating-system: [ubuntu-latest, ubuntu-16.04]
        php-version: ['8.0']
    name: Test PHP 8.0
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Install PHP
        run: |
          sudo DEBIAN_FRONTEND=noninteractive apt-get -y install libicu-dev
          release=$(lsb_release -r -s)
          tar_file=php_"$php_version"%2Bubuntu"$release".tar.xz
          install_dir=~/php/"$php_version"
          curl -o "$tar_file" -L https://bintray.com/shivammathur/php/download_file?file_path="$tar_file"
          sudo mkdir -p ~/php
          sudo chmod -R 777 ~/php
          sudo tar xf "$tar_file" -C ~/php
          rm -rf "$tar_file"
          sudo ln -sf "$install_dir"/bin/* /usr/bin/
          sudo ln -sf "$install_dir"/etc/php.ini /etc/php.ini
        env:
          php_version: ${{ matrix.php-version }}
      - name: Check versions
        run: |
          php -v | head -n 1
          php-cgi -v | head -n 1
          phpdbg -V | head -n 1
          composer -V
          pecl -V
          php-config --version
          phpize -v
      - name: Benchmark
        run: |
          printf "Benchmark with PHP7.3\n"
          sudo phpdismod -v 7.3 xdebug
          sudo curl https://raw.githubusercontent.com/php/php-src/master/Zend/bench.php | php7.3
          printf "Benchmark with PHP${{ matrix.php-version }}\n"
          curl https://raw.githubusercontent.com/php/php-src/master/Zend/bench.php | php

